<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-blog" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Essential modules for developing applications with FastAPI (P6 - Monitoring) | Immersed in Code</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://immersedincode.io.vn/blog/essential-modules-for-developing-applications-with-fastapi-p6-monitoring"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Essential modules for developing applications with FastAPI (P6 - Monitoring) | Immersed in Code"><meta data-rh="true" name="description" content="Hello, FastAPI and I are here to see you again. Over the past week, I started onboarding at a new company, joined a new environment, and met new people, which made me really excited."><meta data-rh="true" property="og:description" content="Hello, FastAPI and I are here to see you again. Over the past week, I started onboarding at a new company, joined a new environment, and met new people, which made me really excited."><meta data-rh="true" property="og:image" content="https://immersedincode.io.vn/img/10_essential-modules-for-developing-applications-with-fastapi-p6/featured.png"><meta data-rh="true" name="twitter:image" content="https://immersedincode.io.vn/img/10_essential-modules-for-developing-applications-with-fastapi-p6/featured.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-09-02T10:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/pxuanbach"><meta data-rh="true" property="article:tag" content="fastapi,python,monitoring,grafana,prometheus,essential-modules-fastapi"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://immersedincode.io.vn/blog/essential-modules-for-developing-applications-with-fastapi-p6-monitoring"><link data-rh="true" rel="alternate" href="https://immersedincode.io.vn/blog/essential-modules-for-developing-applications-with-fastapi-p6-monitoring" hreflang="en"><link data-rh="true" rel="alternate" href="https://immersedincode.io.vn/blog/essential-modules-for-developing-applications-with-fastapi-p6-monitoring" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://immersedincode.io.vn/blog/essential-modules-for-developing-applications-with-fastapi-p6-monitoring","mainEntityOfPage":"https://immersedincode.io.vn/blog/essential-modules-for-developing-applications-with-fastapi-p6-monitoring","url":"https://immersedincode.io.vn/blog/essential-modules-for-developing-applications-with-fastapi-p6-monitoring","headline":"Essential modules for developing applications with FastAPI (P6 - Monitoring)","name":"Essential modules for developing applications with FastAPI (P6 - Monitoring)","description":"Hello, FastAPI and I are here to see you again. Over the past week, I started onboarding at a new company, joined a new environment, and met new people, which made me really excited.","datePublished":"2024-09-02T10:00:00.000Z","author":{"@type":"Person","name":"Bach Pham","description":"Software Engineer","url":"https://github.com/pxuanbach","image":"https://avatars.githubusercontent.com/u/55500268?v=4"},"image":{"@type":"ImageObject","@id":"https://immersedincode.io.vn/img/10_essential-modules-for-developing-applications-with-fastapi-p6/featured.png","url":"https://immersedincode.io.vn/img/10_essential-modules-for-developing-applications-with-fastapi-p6/featured.png","contentUrl":"https://immersedincode.io.vn/img/10_essential-modules-for-developing-applications-with-fastapi-p6/featured.png","caption":"title image for the blog post: Essential modules for developing applications with FastAPI (P6 - Monitoring)"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://immersedincode.io.vn/blog","name":"My Awesome Blog"}}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2VH0PJCNSH"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2VH0PJCNSH",{anonymize_ip:!0})</script>




<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Immersed in Code RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Immersed in Code Atom Feed"><link rel="stylesheet" href="/assets/css/styles.e64f082f.css">
<script src="/assets/js/runtime~main.fdfecc80.js" defer="defer"></script>
<script src="/assets/js/main.7abbe558.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Immersed in Code Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="Immersed in Code Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Immersed in Code</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about">About</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/pxuanbach" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">My GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/essential-modules-for-developing-applications-with-fastapi-p6-monitoring">Essential modules for developing applications with FastAPI (P6 - Monitoring)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/essential-modules-for-developing-applications-with-fastapi-p5-rate-limiting">Essential modules for developing applications with FastAPI (P5 - Rate-limiting)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/essential-modules-for-developing-applications-with-fastapi-p4-job-scheduler">Essential modules for developing applications with FastAPI (P4 - Job Scheduler)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/asynchronous-request-batching-design-pattern-in-nodejs">Asynchronous Request Batching Design Pattern in Node.js</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/destructuring-in-python">Destructuring in Python</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/essential-modules-for-developing-applications-with-fastapi-p3-caching">Essential modules for developing applications with FastAPI (P3 - Caching)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/dockerizing-medusajs-for-optimized-deployment">Dockerize MedusaJS Components: Optimize and Deploy Your Application</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/essential-modules-for-developing-applications-with-fastapi-p2-logging">Essential modules for developing applications with FastAPI (P2 - Logging)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/essential-modules-for-developing-applications-with-fastapi-p1-migration">Essential modules for developing applications with FastAPI (P1 - Migration)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/zero-downtime-deployment-with-docker-compose-nginx">Zero-downtime Deployments with Docker Compose &amp; Nginx</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/welcome">Welcome</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Essential modules for developing applications with FastAPI (P6 - Monitoring)</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-09-02T10:00:00.000Z">September 2, 2024</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/pxuanbach" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/55500268?v=4" alt="Bach Pham"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/pxuanbach" target="_blank" rel="noopener noreferrer"><span>Bach Pham</span></a></div><small class="avatar__subtitle">Software Engineer</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Hello, FastAPI and I are here to see you again. Over the past week, I started onboarding at a new company, joined a new environment, and met new people, which made me really excited.</p>
<p>Getting straight to today&#x27;s main topic, I will introduce a module that integrates with FastAPI, which helps us track the statistics of each API in the application.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="frameworklibrary-version"><strong>Framework/Library version</strong><a href="#frameworklibrary-version" class="hash-link" aria-label="Direct link to frameworklibrary-version" title="Direct link to frameworklibrary-version">​</a></h2>
<p>This project uses <a href="https://www.python.org/" target="_blank" rel="noopener noreferrer">Python</a> 3.10 as the environment and <a href="https://python-poetry.org/" target="_blank" rel="noopener noreferrer">Poetry</a> as the package manager.</p>
<p>The code and examples in this post will use frameworks/libraries with the following versions.</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">[tool.poetry.dependencies]</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">python = &quot;^3.10&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">uvicorn = {extras = [&quot;standard&quot;], version = &quot;^0.24.0.post1&quot;}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">fastapi = &quot;^0.109.1&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">python-multipart = &quot;^0.0.7&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">email-validator = &quot;^2.1.0.post1&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">passlib = {extras = [&quot;bcrypt&quot;], version = &quot;^1.7.4&quot;}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">tenacity = &quot;^8.2.3&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">pydantic = &quot;&gt;2.0&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">emails = &quot;^0.6&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">gunicorn = &quot;^21.2.0&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">jinja2 = &quot;^3.1.2&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">alembic = &quot;^1.12.1&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">python-jose = {extras = [&quot;cryptography&quot;], version = &quot;^3.3.0&quot;}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">httpx = &quot;^0.25.1&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">psycopg = {extras = [&quot;binary&quot;], version = &quot;^3.1.13&quot;}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">sqlmodel = &quot;^0.0.16&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"># Pin bcrypt until passlib supports the latest</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">bcrypt = &quot;4.0.1&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">pydantic-settings = &quot;^2.2.1&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">sentry-sdk = {extras = [&quot;fastapi&quot;], version = &quot;^1.40.6&quot;}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">psycopg2 = &quot;^2.9.9&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">asyncpg = &quot;^0.29.0&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">redis = {extras = [&quot;hiredis&quot;], version = &quot;^5.0.3&quot;}</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">orjson = &quot;^3.10.0&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">apscheduler = &quot;^3.10.4&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">prometheus-fastapi-instrumentator = &quot;^7.0.0&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="monitoring">Monitoring<a href="#monitoring" class="hash-link" aria-label="Direct link to Monitoring" title="Direct link to Monitoring">​</a></h2>
<p>I am confident that this is one of the most important modules when you want to deploy a product to a production environment.</p>
<p>Currently, many packages can help you monitor your FastAPI app. The package I like to use the most is <a href="https://github.com/trallnag/prometheus-fastapi-instrumentator" target="_blank" rel="noopener noreferrer">Prometheus FastAPI Instrumentator</a> (919 stars, 83 forks on 03/09/2024). I often use it along with Prometheus and Grafana, creating visual dashboards from those metrics helps me easily monitor the application. I will discuss this stack in another article.</p>
<p><img decoding="async" loading="lazy" alt="fastapi-instrumentator-prometheus.jpg" src="/assets/images/fastapi-instrumentator-prometheus-450322bbbf007dac79a07d69bc05a419.jpg" width="1046" height="347" class="img_ev3q"></p>
<p>How it’s work?</p>
<ol>
<li>The API server exports an endpoint <code>/metrics</code>, which tracks the HTTP request count, request/response size in bytes, request duration, and more.</li>
<li>We register the <code>/metrics</code> endpoint and set the crawl job duration for the Prometheus service. Next, this service automatically ingests metrics data from the API server, storing the collected data for analysis.</li>
<li>Grafana acts as an admin dashboard, retrieving data from Prometheus and visualizing it in specialized graphs, such as time-series, line charts.</li>
</ol>
<p>Let&#x27;s integrate this package with FastAPI and deploy Prometheus and Grafana to visualize its metrics.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="integrating-with-fastapi">Integrating with FastAPI<a href="#integrating-with-fastapi" class="hash-link" aria-label="Direct link to Integrating with FastAPI" title="Direct link to Integrating with FastAPI">​</a></h3>
<p>We need to initialize an instance of the instrumentator and export it when the application starts.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockTitle_Ktv7">./app/main.py</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#0c4a6e">from</span><span class="token plain"> fastapi </span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> FastAPI</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">from</span><span class="token plain"> contextlib </span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> asynccontextmanager</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">from</span><span class="token plain"> prometheus_fastapi_instrumentator </span><span class="token keyword" style="color:#0c4a6e">import</span><span class="token plain"> Instrumentator</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#475569">@asynccontextmanager</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">async</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">def</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">lifespan</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:#6A9955"># start up</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    instrumentator</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">expose</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">yield</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:#6A9955"># shut down</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#0c4a6e">pass</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">app </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    title</span><span class="token operator" style="color:#475569">=</span><span class="token plain">settings</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">PROJECT_NAME</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    openapi_url</span><span class="token operator" style="color:#475569">=</span><span class="token string-interpolation string" style="color:#64748b">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#475569">{</span><span class="token string-interpolation interpolation">settings</span><span class="token string-interpolation interpolation punctuation" style="color:#475569">.</span><span class="token string-interpolation interpolation">API_STR</span><span class="token string-interpolation interpolation punctuation" style="color:#475569">}</span><span class="token string-interpolation interpolation punctuation" style="color:#475569">{</span><span class="token string-interpolation interpolation">settings</span><span class="token string-interpolation interpolation punctuation" style="color:#475569">.</span><span class="token string-interpolation interpolation">API_VERSION_STR</span><span class="token string-interpolation interpolation punctuation" style="color:#475569">}</span><span class="token string-interpolation string" style="color:#64748b">/openapi.json&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    generate_unique_id_function</span><span class="token operator" style="color:#475569">=</span><span class="token plain">custom_generate_unique_id</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    lifespan</span><span class="token operator" style="color:#475569">=</span><span class="token plain">lifespan</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">instrumentator </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> Instrumentator</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    should_group_status_codes</span><span class="token operator" style="color:#475569">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    should_ignore_untemplated</span><span class="token operator" style="color:#475569">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    excluded_handlers</span><span class="token operator" style="color:#475569">=</span><span class="token punctuation" style="color:#475569">[</span><span class="token string" style="color:#64748b">&quot;.*admin.*&quot;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;/metrics&quot;</span><span class="token punctuation" style="color:#475569">]</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token plain">instrument</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#475569">)</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After initializing and running the application, you can easily find monitoring metrics at the <code>/metrics</code> endpoint.</p>
<p><img decoding="async" loading="lazy" alt="metrics-api-result.png" src="/assets/images/metrics-api-result-cdacd4f72250ce179b21aee3bd6926bd.png#center" width="864" height="597" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-prometheus-and-grafana-services">Setting up Prometheus and Grafana services<a href="#setting-up-prometheus-and-grafana-services" class="hash-link" aria-label="Direct link to Setting up Prometheus and Grafana services" title="Direct link to Setting up Prometheus and Grafana services">​</a></h3>
<p>To quickly see the results, I recommend that you simply copy and paste as instructed in this section.</p>
<p>First, create a <code>docker-compose.yaml</code> file like this:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockTitle_Ktv7">./monitoring/docker-compose.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token key atrule">services</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token key atrule">prometheus</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> prom/prometheus</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">v2.54.0</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> ./prometheus.yaml</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">/etc/prometheus/prometheus.yml</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">/prometheus</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">stopped</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token key atrule">grafana</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> grafana/grafana</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">10.4.7</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&quot;3001:3000&quot;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> grafana</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain">/var/lib/grafana</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token key atrule">prometheus-data</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  grafana</span><span class="token punctuation" style="color:#475569">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#475569">:</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, create a <code>prometheus.yaml</code> file in the same location.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockTitle_Ktv7">./monitoring/prometheus.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token key atrule">global</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token key atrule">scrape_interval</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> 15s</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token key atrule">scrape_configs</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> </span><span class="token key atrule">job_name</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> fastapi</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">scrape_interval</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> 15s</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">scrape_timeout</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> 10s</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">metrics_path</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;/metrics&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token key atrule">static_configs</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#0f172a"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">-</span><span class="token plain"> </span><span class="token key atrule">targets</span><span class="token punctuation" style="color:#475569">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">[</span><span class="token string" style="color:#64748b">&#x27;host.docker.internal:8000&#x27;</span><span class="token punctuation" style="color:#475569">]</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You might be curious about the <code>host.docker.internal</code> address. What is it?</p>
<ul>
<li>The reason for this is that Docker network works differently on Linux, Windows, and macOS.</li>
<li>On Linux, Docker uses the system&#x27;s built-in networking features.</li>
<li>But on Windows and macOS, Docker runs inside a virtual machine. Because of this, Windows and macOS need a special way for containers to talk to the host machine, which is why we use <code>host.docker.internal</code>.</li>
</ul>
<p>Since my OS is Windows, I&#x27;m using it as the host for the Prometheus service so that it can call the FastAPI server, which is not containerized.</p>
<p><img decoding="async" loading="lazy" alt="connect-to-service-outside-docker-deamon" src="/assets/images/connect-to-service-outside-docker-deamon-42d1d6da75dbe641c6d5530e6027e4d2.png#center" width="503" height="443" class="img_ev3q"></p>
<p>Now, docker compose up!</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">docker compose -f ./monitoring/docker-compose.yaml up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="docker-compose-up-prometheus-grafana" src="/assets/images/docker-compose-up-prometheus-grafana-1fbe1ac3e7929309b8ae72b538f850af.png#center" width="553" height="191" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-grafana-dashboard">Configuring Grafana Dashboard<a href="#configuring-grafana-dashboard" class="hash-link" aria-label="Direct link to Configuring Grafana Dashboard" title="Direct link to Configuring Grafana Dashboard">​</a></h3>
<p>Once the services are up and running, you will see logs for requests to the /metrics endpoint being generated every 15 seconds (the <code>scrape_interval</code> of Prometheus).</p>
<p><img decoding="async" loading="lazy" alt="prometheus-crawl-metrics-api-logs" src="/assets/images/prometheus-crawl-metrics-api-logs-e89c8d8a2dd353b7f048988d720f79c8.png#center" width="545" height="195" class="img_ev3q"></p>
<p>Next, open your browser and go to <code>127.0.0.1:3001</code>; the Grafana login page will appear. The default username and password are <strong>admin</strong>.</p>
<p>After logging in, add Prometheus as a Data source with the connection URL set to <code>http://prometheus:9090</code>.</p>
<p>Why is <code>prometheus:9090</code>?</p>
<ul>
<li>Containers with a shared Docker Compose configuration can communicate with each other using the service name as the domain.</li>
<li>9090 is the default port of the Prometheus service.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="save-and-test-prometheus-successfully" src="/assets/images/save-and-test-prometheus-successfully-63f3629489eec63e856cec8816fb9d73.png#center" width="954" height="280" class="img_ev3q"></p>
<p>Back to Home, click “Create your first dashboard” &gt; &quot;Import a dashboard”. You will see the following screen.</p>
<p><img decoding="async" loading="lazy" alt="import-grafana-dashboard" src="/assets/images/import-grafana-dashboard-5831f7ea5268c284f186012153268809.png#center" width="1166" height="903" class="img_ev3q"></p>
<p>You can easily find the <a href="https://github.com/pxuanbach/fastapi-essential-modules/blob/module/monitoring/monitoring/dashboard.json" target="_blank" rel="noopener noreferrer"><code>dashboard.json</code></a> file in my github repository. Import that file and see the result.</p>
<p><img decoding="async" loading="lazy" alt="grafana-fastapi-dashboard" src="/assets/images/grafana-fastapi-dashboard-5c4a02c182bcde2bdec9e991a1f42293.png#center" width="1902" height="913" class="img_ev3q"></p>
<p>Niceee!!!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="notes">Notes<a href="#notes" class="hash-link" aria-label="Direct link to Notes" title="Direct link to Notes">​</a></h2>
<p>These are not all the statistics that need to be tracked. In the real world, we need to track many more statistics, such as logs, RAM usage, CPU usage, total connections used, etc. However, for the scope of this article, this is enough to show you how we can monitor a FastAPI application.</p>
<p>Additionally, I would like to mention the use of packages that help monitor the application. These packages also consume resources to monitor the system, and they can become a performance bottleneck for the application. Always use it carefully, so you don&#x27;t get into a mess.</p>
<p>Furthermore, you can also refer to a few other libraries such as…</p>
<ul>
<li><a href="https://github.com/stephenhillier/starlette_exporter" target="_blank" rel="noopener noreferrer">stephenhillier/starlette_exporter</a> (310 stars, 35 forks on 03/09/2024)</li>
<li><a href="https://github.com/perdy/starlette-prometheus" target="_blank" rel="noopener noreferrer">perdy/starlette-prometheus</a> (272 stars, 31 forks on 03/09/2024)</li>
<li><a href="https://github.com/acidjunk/starlette-opentracing" target="_blank" rel="noopener noreferrer">acidjunk/starlette-opentracing</a> (66 stars, 6 forks on 03/09/2024)</li>
<li><a href="https://github.com/open-telemetry/opentelemetry-python-contrib/tree/main/instrumentation/opentelemetry-instrumentation-fastapi" target="_blank" rel="noopener noreferrer">open-telemetry/opentelemetry-instrumentation-fastapi</a> (###)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>I hope this post was useful. If you need a project to run a demo on your environment, here is my <a href="https://github.com/pxuanbach/fastapi-essential-modules/tree/module/monitoring" target="_blank" rel="noopener noreferrer">Git repository</a>.</p>
<p>See you again!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<ul>
<li><a href="https://github.com/Kludex/fastapi-prometheus-grafana?tab=readme-ov-file" target="_blank" rel="noopener noreferrer">Kludex/fastapi-prometheus-grafana: FasAPI + Prometheus + Grafana! <!-- -->🎉<!-- --> (github.com)</a></li>
</ul></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/fastapi">fastapi</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/python">python</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/monitoring">monitoring</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/grafana">grafana</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/prometheus">prometheus</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/essential-modules-fastapi">essential-modules-fastapi</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/essential-modules-for-developing-applications-with-fastapi-p5-rate-limiting"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Essential modules for developing applications with FastAPI (P5 - Rate-limiting)</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#frameworklibrary-version" class="table-of-contents__link toc-highlight"><strong>Framework/Library version</strong></a></li><li><a href="#monitoring" class="table-of-contents__link toc-highlight">Monitoring</a><ul><li><a href="#integrating-with-fastapi" class="table-of-contents__link toc-highlight">Integrating with FastAPI</a></li><li><a href="#setting-up-prometheus-and-grafana-services" class="table-of-contents__link toc-highlight">Setting up Prometheus and Grafana services</a></li><li><a href="#configuring-grafana-dashboard" class="table-of-contents__link toc-highlight">Configuring Grafana Dashboard</a></li></ul></li><li><a href="#notes" class="table-of-contents__link toc-highlight">Notes</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ImmersedinCode Blog</div><ul class="footer__items clean-list"><li class="footer__item"><p>Simplicity is the soul of efficiency.</p></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/pxuanbach" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:pxuanbach1412@gmail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gmail<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/pham-bach-97a389217/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Bach Pham, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>